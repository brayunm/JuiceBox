var d=Object.defineProperty;var l=(a,e,t)=>e in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>l(a,typeof e!="symbol"?e+"":e,t);class g{static processSessions(e){return!(e!=null&&e.results)||!Array.isArray(e.results)?(console.log("Invalid charge sessions sessions format"),[]):e.results.map(t=>this.processSession(t))}static processSession(e){const t=this.parseIsoDuration(e.duration),r=e.volume,i=r/t*60>this.FAST_CHARGING_THRESHOLD?"fast":"slow";return{startDate:e.startDateTime,endDate:e.endDateTime,duration:this.formatDuration(t),poleId:e.chargePointSerial||e.chargePointReference||"",location:this.getSessionLocation(e),kwh:r,chargingSpeed:i}}static parseIsoDuration(e){if(!e||typeof e!="string")return 0;const t=e.match(/PT(\d+)S/);return t?Math.round(parseInt(t[1])/60):0}static formatDuration(e){const t=Math.floor(e/60),r=e%60;return t>0?`${t}h ${r}m`:`${r}m`}static getSessionLocation(e){return e.chargePointAddress?`${e.chargePointAddress.street}, ${e.chargePointAddress.city}, ${e.chargePointAddress.postalCode}, ${e.chargePointAddress.country}`:"Unknown location"}}n(g,"FAST_CHARGING_THRESHOLD",22);class o{static async fetchChargeTokenIds(e){try{const t=e.substring(0,e.indexOf(this.CHARGE_SESSIONS_URL_PATTERN))+this.ASSET_OVERVIEW_URL_PATTERN,s=await(await fetch(t,{method:"GET",credentials:"include",headers:{Accept:"application/json, text/plain, */*"}})).json();return s!=null&&s.chargeTokens&&Array.isArray(s.chargeTokens)?s.chargeTokens.map(i=>i.uuid):(console.error("Invalid asset overview data format"),[])}catch(t){return console.error("Error fetching charge token IDs:",t),[]}}static async fetchChargingSessionsData(e,t){try{const r=this.createRequestPayload(t),i=await(await fetch(e,{method:"POST",credentials:"include",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(r)})).json();return g.processSessions(i)}catch(r){return console.error("Error fetching charge sessions data:",r),[]}}static createRequestPayload(e){return{startDateTime:"2024-08-01T00:00:00+02:00",endDateTime:"2025-12-31T23:59:59+02:00",chargeTokenIds:e,limit:1e3,offset:0,sortField:"startDateTime",sortOrder:"asc"}}static saveSessionsInStorage(e){chrome.runtime.sendMessage({action:"saveChargingSessions",data:e},t=>{chrome.runtime.lastError?(console.error("Content script - Error sending to background:",chrome.runtime.lastError),this.fallbackDirectStorage(e)):console.log("Content script - Data sent to background script:",t)})}static fallbackDirectStorage(e){chrome.storage.local.set({chargingSessions:e},()=>{chrome.runtime.lastError&&console.error("Content script - Error saving to storage:",chrome.runtime.lastError)})}}n(o,"CHARGE_SESSIONS_URL_PATTERN","/charge-sessions"),n(o,"ASSET_OVERVIEW_URL_PATTERN","/asset-overview");const c=class c{constructor(){n(this,"chargeTokenIds",[]);this.initialize()}initialize(){new PerformanceObserver(t=>{for(const r of t.getEntries())r.name.includes(c.ASSET_OVERVIEW_URL_PATTERN)?this.storeChargeIdToken(r.name):r.name.includes(c.CHARGE_SESSIONS_URL_PATTERN)&&this.storeSessions(r.name)}).observe({entryTypes:["resource"]})}async storeChargeIdToken(e){this.chargeTokenIds=await o.fetchChargeTokenIds(e)}async storeSessions(e){var t;try{if(!((t=this.chargeTokenIds)!=null&&t.length)){const s=await o.fetchChargeTokenIds(e);if(s.length)this.chargeTokenIds=s;else return}const r=await o.fetchChargingSessionsData(e,this.chargeTokenIds);r.length>0&&o.saveSessionsInStorage(r)}catch(r){console.error("Content script - Error processing charge sessions request:",r)}}};n(c,"CHARGE_SESSIONS_URL_PATTERN","/charge-sessions"),n(c,"ASSET_OVERVIEW_URL_PATTERN","/asset-overview");let h=c;new h;
