var h=Object.defineProperty;var l=(i,e,t)=>e in i?h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>l(i,typeof e!="symbol"?e+"":e,t);import{s as c,H as d}from"./assets/index-ZUJkI0Yq.js";class o{static handleMessage(e,t,a){switch(e.action){case"saveChargingSessions":return this.handleSaveChargingSessions(e,a);case"saveChargingSessionsBatch":return this.handleSaveChargingSessionsBatch(e,a);case"reset":return this.handleReset(e,a);default:return a({status:"error",message:"Unknown action"}),!1}}static handleSaveChargingSessions(e,t){return c.saveSessionsToStorage(e.data),this.showNotification(),t({status:"success"}),!0}static handleSaveChargingSessionsBatch(e,t){const{data:a,batchInfo:s}=e;return console.log(`Background script - Processing batch ${s.batchNumber}/${s.totalBatches} with ${a.length} sessions`),s.batchNumber===1&&(console.log("Background script - Starting new batch collection"),this.batchedSessions=[],this.expectedTotalBatches=s.totalBatches,this.receivedBatches=0),this.batchedSessions=this.batchedSessions.concat(a),this.receivedBatches++,console.log(`Background script - Received batch ${s.batchNumber}/${s.totalBatches}. Total sessions so far: ${this.batchedSessions.length}/${s.totalSessions}`),s.isLastBatch||this.receivedBatches>=this.expectedTotalBatches?(console.log(`Background script - All batches received. Saving ${this.batchedSessions.length} sessions.`),c.saveSessionsToStorage(this.batchedSessions),this.showNotification(),this.verifyStoredData(this.batchedSessions.length),t({status:"success",message:`Saved all ${this.batchedSessions.length} sessions from ${this.receivedBatches} batches`}),this.resetBatchingState()):(console.log(`Background script - Batch ${s.batchNumber} received, waiting for more...`),t({status:"success",message:`Received batch ${s.batchNumber}/${s.totalBatches}`})),!0}static handleReset(e,t){return c.clearSessionsFromStorage(),this.resetBatchingState(),t({status:"success",message:"Data reset"}),!0}static showNotification(){chrome.notifications.create({title:"JuiceBox",message:"Charging sessions data has been updated",iconUrl:"public/48.png",type:"basic"},e=>{chrome.runtime.lastError?console.error("Notification error:",chrome.runtime.lastError):console.log("Notification created successfully:",e)})}static async verifyStoredData(e){try{const t=await c.getSavedSessionsCount();t===e?console.log(`Verification - Successfully stored ${t} sessions`):console.error(`Verification - Expected ${e} sessions but found ${t}`)}catch(t){console.error("Error verifying stored data:",t)}}static resetBatchingState(){this.batchedSessions=[],this.expectedTotalBatches=0,this.receivedBatches=0}}r(o,"batchedSessions",[]),r(o,"expectedTotalBatches",0),r(o,"receivedBatches",0);function g(){return chrome.runtime.getManifest().version}const u=()=>setInterval(chrome.runtime.getPlatformInfo,2e4),n=()=>{u(),d("A-EU-6929660126",{appVersion:g()})};chrome.runtime.onStartup.addListener(n);chrome.runtime.onInstalled.addListener(n);chrome.action.onClicked.addListener(()=>{chrome.tabs.create({url:chrome.runtime.getURL("overview.html")}).catch(()=>alert("Unable to open chrome extension"))});chrome.runtime.onMessage.addListener((i,e,t)=>{try{return o.handleMessage(i,e,t)}catch(a){return console.error("Background - Error in message handler:",a),t({status:"error",message:"Handler error"}),!1}});
